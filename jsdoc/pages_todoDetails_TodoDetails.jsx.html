<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages/todoDetails/TodoDetails.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pages/todoDetails/TodoDetails.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, {useContext, useEffect, useState} from 'react';
import cl from './TodoDetails.module.scss'
import {Context} from "../../index";
import {getDownloadURL, ref, uploadBytes} from "firebase/storage";
import {useParams} from "react-router-dom";
import {useCollectionData} from "react-firebase-hooks/firestore";
import {collection, Timestamp,doc, updateDoc} from "firebase/firestore";
import {CircularProgress} from "@mui/material";
import {v4} from "uuid";

/**
 * Реакт компонент
 * На странице редактирования можно посмотерть текущие данные поста и изменить их.
 *
 * @returns {JSX.Element}
 * @constructor
 */
const TodoDetails = () => {
    // Инициализация
    const [update, setUpdate] = useState(0)
    const [time, setTime] = useState('')
    const [title, setTitle] = useState("");
    const [description, setDescription] = useState("");
    const [image,setImage] = useState(null)

    const params = useParams()
    const [todo, setTodo] = useState({})
    const [url, setUrl] = useState('')
    const {storage, db} = useContext(Context)
    const [data] = useCollectionData(collection(db,'data'))

    // Получение файла
    useEffect(() => {
        if(data) {
            data.forEach(elem => {
                if(Number(params.id) === elem.id) {
                    setTodo(elem)
                    getDownloadURL(ref(storage, `img/${elem.fileName}`))
                        .then((url) => {
                            setUrl(url)
                        });
                } else {
                    return &lt;h1>Not found :(&lt;/h1>
                }
            })
        }
    },[data, update])

    /**
     * Функция, которая отвечает за заполнение и загрузку обновленного поста на сервер
     * @param {object} e - Ивент
     * @returns {Promise&lt;void>}
     * @example
     * async function writeNewPost(e) {
     *         e.preventDefault()
     *
     *             // Добавление файла
     *             const imageName = image.name + v4()
     *             const imgRef = ref(storage, `img/${imageName}`);
     *             await uploadBytes(imgRef, image).then((e) => {
     *                 console.log('File updated successfully!')
     *                 alert("Успешно!")
     *             });
     *
     *             // Обновление туду
     *             const updateTodo = {
     *                 title,
     *                 description,
     *                 dateCompletion: time,
     *                 createdAt: Timestamp.fromDate(new Date()),
     *                 fileName: imageName
     *             };
     *
     *             const docRef = doc(db, "data", todo.key);
     *
     *             await updateDoc(docRef, updateTodo);
     *             setUpdate(update + 1)
     *     }
     */
    async function writeNewPost(e) {
        e.preventDefault()

        if(title &amp;&amp; description &amp;&amp; time) {
            // Добавление файла
            const imageName = image.name + v4()
            const imgRef = ref(storage, `img/${imageName}`);
            await uploadBytes(imgRef, image).then((e) => {
                console.log('File updated successfully!')
                alert("Успешно!")
            });

            // Обновление туду
            const updateTodo = {
                title,
                description,
                dateCompletion: time,
                createdAt: Timestamp.fromDate(new Date()),
                fileName: imageName
            };

            const docRef = doc(db, "data", todo.key);

            await updateDoc(docRef, updateTodo);
            setUpdate(update + 1)

            // Очистка полей
            setTime('')
            setTitle("");
            setDescription("");
        } else {
            alert("Заполните все поля!")
        }
    }

    return (
        &lt;>
            {
                !data ? &lt;div className='loader'>&lt;CircularProgress color="secondary" />&lt;/div>
                    : &lt;>
                        &lt;div className={cl.wrapper}>
                            &lt;div className={cl.form}>
                                &lt;h3>Edit form&lt;/h3>
                                &lt;form>
                                    &lt;input
                                        type="text"
                                        placeholder="Change title"
                                        value={title}
                                        onChange={(e) => setTitle(e.target.value)}
                                    />
                                    &lt;input
                                        type="text"
                                        placeholder="Change description"
                                        value={description}
                                        onChange={(e) => setDescription(e.target.value)}
                                    />
                                    &lt;input
                                        type="time"
                                        onChange={(e) => setTime(e.target.value)}
                                    />
                                    &lt;input
                                        type="file"
                                        onChange={e => setImage(e.target.files[0])}
                                    />
                                    &lt;button className={cl.btn} onClick={writeNewPost}>Edit todos&lt;/button>
                                &lt;/form>
                            &lt;/div>
                            &lt;div className={cl.card}>
                                &lt;h3>Data now&lt;/h3>
                                &lt;div className={cl.title}>
                                    Title: &lt;i>{todo.title}&lt;/i>
                                &lt;/div>
                                &lt;div className={cl.desc}>
                                    Description: &lt;i>{todo.description}&lt;/i>
                                &lt;/div>
                                &lt;div className={cl.time}>
                                    Date of completion: &lt;i>{todo.dateCompletion}&lt;/i>
                                &lt;/div>
                                &lt;div>
                                    &lt;img style={{width: 200, height: 200, margin: 10}} src={url} alt=""/>
                                &lt;/div>
                                &lt;div className={cl.file}>
                                    If this is not a picture click  &lt;a href={url}>here&lt;/a>
                                &lt;/div>
                            &lt;/div>
                        &lt;/div>
                    &lt;/>
            }
        &lt;/>
    );
};

export default TodoDetails;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="About.html">About</a></li><li><a href="AllTodo.html">AllTodo</a></li><li><a href="App.html">App</a></li><li><a href="CreateTodo.html">CreateTodo</a></li><li><a href="Header.html">Header</a></li><li><a href="Timer.html">Timer</a></li><li><a href="Todo.html">Todo</a></li><li><a href="TodoDetails.html">TodoDetails</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-install.html">install</a></li></ul><h3>Global</h3><ul><li><a href="global.html#formattedTime">formattedTime</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Sun Nov 20 2022 04:42:00 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
